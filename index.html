<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Websocket Live test Rig</title>
    <style>
        body {font-family: sans-serif;padding: 20px;background: #121212;color: #fff;}
        #log {background: #000;padding: 10px;height: 300px;overflow-y:scroll;border: 1px solid #333 }
        .status-on{color: #00ff00}
        .status-off{color: #ff0000}
    </style>
</head>
<body>
<h1>Websocket Broadcast Console</h1>
<p id="status" class="status-off"> Connecting...</p>
<form id ="messageForm">
    <input id="message-input" type="text" placeholder="Send cargo..." required/>
    <button type="submit">Deploy Message</button>
</form>
<h3>Live Stream Logs:</h3>

<pre id="log"></pre>
</body>
<script>
    const statusEl=document.getElementById('status');
    const log=document.getElementById('log');
    const input=document.getElementById('message-input');

    //initiate the handshake
    const socket=new WebSocket('ws://localhost:8080');
    const appendlog=(label,message)=>{
        const entry=`${new Date().toLocaleTimeString()} ${label} ${message}\n`;
        log.textContent=entry+log.textContent;
    }
    socket.addEventListener('open',()=>{
        statusEl.textContent="Connected:ws://localhost:8080"
        statusEl.className='status-on';
        appendlog('[SYSTEM]','Tunnel Established.');

    })
    //closed when connection disabled
    //socket drops or event close is called then socket is dead
    socket.addEventListener('close',()=>{
        statusEl.textContent="Disconnected"
        statusEl.className='status-off';
        appendlog('[SYSTEM]','Tunnel Collapsed.');

    });
    //for listening to messages
    socket.addEventListener('message',(e)=>{
        appendlog('[RECEIVED]',e.data);

    })
    document.getElementById('messageForm').addEventListener('submit',(e)=>{
        e.preventDefault();

        if (socket.readyState !== WebSocket.OPEN) {
            appendlog('[ERROR]','No active tunnel found.');
            return;
        }
        const msg= input.value.trim();
        socket.send(msg);
        appendlog('[SENT]',msg);
        input.value = '';
    })
</script>
</html>